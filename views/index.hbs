<!DOCTYPE html>
<html lang="en">
   <!-- Building the settings and title element above the form-->
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <link rel="stylesheet" href="css/style.css" />
        <title>Fraudtech</title>
    </head>
    <body>
        <h1>Fraudtech feature request</h1>
    </body>

</head>
   
   <body>
      <form action = "./submit" id = "feature_request_form" name = "feature_request_form" onsubmit = "return(validate());" method = "POST">
         <table cellspacing = "2" cellpadding = "2" border = "1">

            <tr id = "LOGid_element">
               <td align = "right">Login</td>
               <td>
                  <input hidden type = "text" id = "LOGid_ht" name = "LOGid" value = "1"/>
                  <input type = "text" id = "Login_ht" name = "Login" placeholder = "Enter your unique login id here" required/>
                  <input hidden type = "text" id = "firstname_ht" name = "firstname" placeholder = "Enter your first name here" />
                  <input hidden type = "text" id = "lastname_ht" name = "lastname" placeholder = "Enter your last name here" />
                  <input hidden type = "text" id = "contact_info_ht" name = "contact_info" size = "42" placeholder = "Enter your contact info here" required/>
                  <textarea hidden id = "notes_ht" name = "notes" rows = "5" cols = "80" placeholder = "Enter any notes here" /></textarea>
               </td>
            </tr>

            <tr>
               <td align = "right">Name</td>
               <td><input type = "text" name = "Name" placeholder = "Enter your name here"/></td>
            </tr>

            <tr>
               <td align = "right">Team</td>
               <td><input type = "text" name = "Team" placeholder = "Enter your Team ID here"/></td>
            </tr>
            
            <tr>
               <td align = "right">What is the business proccess name/tool name</td>
               <td><textarea name = "ProcName" rows = "5" cols = "80" placeholder = "type your process name here"></textarea></td>
            </tr>
            
            <tr>
               <td align = "right">Please provide a brief summary of the current business process and time taken to complete</td>
               <td><textarea name = "OldDesc" rows = "5" cols = "80" placeholder = "Give us the description of the old process here"></textarea></td>
            </tr>

            <tr>
               <td align = "right">How many staff are or will use the tool/process</td>
               <td>
                  <input type = "number" name = "NoStaff" min = "1"/>
               </td>
            </tr>

            <tr>
               <td align = "right">Please provide a numbered list of all the required features</td>
               <td id = "reqFeatures">
                  <input type= "button" value = "Add element" id="addReqFeature">
               </td>
            </tr>

            <tr>
               <td align = "right">Please outline any ongoing maintenance that may be required for this enhancement/process</td>
               <td><textarea name = "maintenance"  rows = "5" cols = "80" placeholder = "Write about ongoing maintenance here"/></textarea></td>
            </tr>

            <tr>
               <td align = "right">Please identify all known stakeholders of the current business process</td>
               <td id = "stakeHolders">
                  <input type= "button" value = "Add Stakeholder" id="addStakeHolder">
               </td>
            </tr>

            <tr>
               <td align = "right">Please attach any supporting documents</td>
               <td>
                  <input type = "file" name = "Attach" />
               </td>
            </tr>
            
            <tr>
               <td align = "right"></td>
               <td>
                  <input type = "submit" value = "Submit" id = "Submit"/>
                  <input type= "button" value = "Download" onclick="download(feature_request_form)" id="Download" />

               </td>
            </tr>
            
         </table>
      </form>      
   </body>
   <script type = "text/javascript">
        //<!--

           // Form validation code will come here.
           function validate() {
              
               // get a reference to all input[text], input[number], and textarea's on the page
               var inputs = document.querySelectorAll('input[type=text], input[type=number], textarea');

               // inputs is an array of elements
               for (var element of inputs) {
                  console.log(element.name, element.value);
                  if (element.value == "" ) {
                     alert( "Please provide details for:" + element.name);
                     element.focus();
                     return false
                  }
               }

              return( true );
           }

           function downloadData(contentType,data,filename){
               
               var link=document.createElement("A");
               link.setAttribute("href",encodeURI("data:"+contentType+","+data));
               link.setAttribute("style","display:none");
               link.setAttribute("download",filename);
               document.body.appendChild(link); //needed for firefox
               console.log(link.outerHTML);
               link.click();
               setTimeout(function(){
                  document.body.removeChild(link);
               },1000);
            }
            
            function fromToXml(form){
               var xmldata=['<?xml version="1.0"?>'];
                  xmldata.push("<form>");
               var inputs=form.elements;
               for(var i=0;i<inputs.length;i++){
                  var el=document.createElement("ELEMENT");
                  if (inputs[i].name){
                     el.setAttribute("name",inputs[i].name);
                     el.setAttribute("value",inputs[i].value);
                     xmldata.push(el.outerHTML);
                  }
                  
               }
               xmldata.push("</form>");
               return xmldata.join("\n");
            }
            
            
            function download(frm){
               
               if (!validate()){
                  return false;
               }
               var data=fromToXml(frm);
               console.log(data);
               
               downloadData("text/xml",data,"export.xml");
            }

            var button1 = document.getElementById("addReqFeature");
            var element1 = document.getElementById("reqFeatures");
            var n1 = 0;

            button1.addEventListener('click', function (event) {
               n1++;

               // create new textarea
               var new_textarea = document.createElement('textarea');
               new_textarea.setAttribute('id', 'feature_' + n1);
               new_textarea.setAttribute('name', 'feature_' + n1);
               //rows = "5" cols = "80"
               new_textarea.setAttribute('rows', '5');
               new_textarea.setAttribute('cols', '80');
               new_textarea.setAttribute('placeholder', 'Enter the desired feature here');
               
               // create label for textarea
               var new_label = document.createElement('label');
               new_label.setAttribute('for', new_textarea.id)
               new_label.textContent = 'Feature ' + n1 + ' Description'

               // add label and textarea to the form
               element1.appendChild(new_label);
               element1.appendChild(new_textarea);
            });

            /*
            <td align = "right">Please identify all known stakeholders of the current business process</td>
            <td id = "stakeHolders">
               <input type= "button" value = "Add Stakeholder" id="addStakeHolder">
            </td>
            */
            var button2 = document.getElementById("addStakeHolder");
            var element2 = document.getElementById("stakeHolders");
            var n2 = 0;

            button2.addEventListener('click', function (event) {
               n2++;

               // create new input[text]
               var new_text = document.createElement('input');
               new_text.setAttribute('type', 'text');
               new_text.setAttribute('id', 'stakeHolder_' + n2);
               new_text.setAttribute('name', 'stakeHolder_' + n2);
               new_text.setAttribute('placeholder', 'Enter the stakeholders name here');
               
               // create label for input[text]
               var new_label = document.createElement('label');
               new_label.setAttribute('for', new_text.id)
               new_label.textContent = 'StakeHolder ' + n2

               // add label and textarea to the form
               element2.appendChild(new_label);
               element2.appendChild(new_text);
            });

            /*Dynamically check the database for that LOGid, 
            and fill the elements firstname, lastname, contact 
            details and notes
            */
            var LOGid_JS = document.getElementById("Login_ht");
            //var xhttp = new XMLHttpRequestEventTarget()

            LOGid_JS.addEventListener('change', function (event) {
               document.getElementById("firstname_ht").removeAttribute("hidden");
               document.getElementById("lastname_ht").removeAttribute("hidden");
               document.getElementById("contact_info_ht").removeAttribute("hidden");
               document.getElementById("notes_ht").removeAttribute("hidden");
               document.getElementById("firstname_ht").setAttribute("required", "");
               document.getElementById("lastname_ht").setAttribute("required", "");
               document.getElementById("contact_info_ht").setAttribute("required", "");
               document.getElementById("notes_ht").setAttribute("required", "");
               var xhttp = new XMLHttpRequest();
               xhttp.onreadystatechange = function() {
                  if (this.readyState == 4 && this.status == 200) {
                     console.log(JSON.parse(this.responseText)); //throwing to the console log
                  }
               };
               xhttp.open("GET", "/people_request?login_qu="+document.getElementById("Login_ht").value, true); 
               xhttp.send();
            });

        //-->
     </script>  
</html>